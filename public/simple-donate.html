<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simple Donate - Rejewvenate</title>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/styles.css">
  <script src="https://js.stripe.com/v3/"></script>
  <style>
    /* Page-specific styles for simple-donate.html */
    .donate-container {
      max-width: 800px;
      margin: 40px auto;
      padding: 40px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .donate-container h2 {
      color: #003366;
      margin-bottom: 20px;
      font-size: 2rem;
      font-weight: 700;
    }

    .donate-container p {
      color: #666;
      margin-bottom: 30px;
      font-size: 1.1rem;
      line-height: 1.6;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
    }

    .donation-options {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 0;
      margin: 40px 0;
      align-items: center;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    .amount-btn {
      padding: 18px 24px;
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 1.1rem;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      width: 100%;
      max-width: 200px;
      justify-self: center;
    }

    .amount-btn:hover {
      background: linear-gradient(135deg, #218838 0%, #1ea085 100%);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      transform: translateY(-1px);
    }

    .amount-btn:active {
      transform: translateY(0);
    }

    .divider {
      color: #666;
      font-size: 0.9rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 0 20px;
      text-align: center;
    }

    .custom-amount-section {
      text-align: center;
      width: 100%;
      max-width: 200px;
      justify-self: center;
    }

    .custom-amount-section h3 {
      color: #003366;
      margin-bottom: 15px;
      font-size: 1rem;
      font-weight: 600;
    }

    .custom-amount-input {
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: center;
    }

    .custom-amount-input input {
      padding: 14px 16px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 0.95rem;
      width: 100%;
      text-align: center;
      transition: all 0.3s ease;
      background: white;
    }

    .custom-amount-input input:focus {
      outline: none;
      border-color: #004080;
      box-shadow: 0 0 0 2px rgba(0, 64, 128, 0.1);
    }

    .custom-amount-input input::placeholder {
      color: #999;
    }

    .custom-donate-btn {
      padding: 14px 20px;
      background: linear-gradient(135deg, #004080 0%, #002244 100%);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95rem;
      transition: all 0.3s ease;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
      width: 100%;
    }

    .custom-donate-btn:hover {
      background: linear-gradient(135deg, #00509e 0%, #003366 100%);
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
      transform: translateY(-1px);
    }

    .custom-donate-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
      color: #666;
    }

    .suggested-amount {
      margin-top: 30px;
      text-align: center;
    }

    .suggested-btn {
      background: linear-gradient(135deg, #004080 0%, #002244 100%);
      max-width: 250px;
    }

    .suggested-btn:hover {
      background: linear-gradient(135deg, #00509e 0%, #003366 100%);
    }

    .form-section {
      margin-bottom: 30px;
      text-align: left;
    }

    .form-section h3 {
      color: #003366;
      margin-bottom: 20px;
      font-size: 1.2rem;
      font-weight: 600;
      text-align: center;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 15px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      color: #333;
      font-weight: 500;
      font-size: 0.9rem;
    }

    .form-group input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: white;
    }

    .form-group input:focus {
      outline: none;
      border-color: #004080;
      box-shadow: 0 0 0 2px rgba(0, 64, 128, 0.1);
    }

    .form-group input::placeholder {
      color: #999;
    }

    .socials {
      margin-bottom: 20px;
    }

    .socials a {
      color: white;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: opacity 0.3s ease;
    }

    .socials a:hover {
      opacity: 0.8;
    }

    .socials img {
      width: 24px;
      height: 24px;
    }

    @media (max-width: 768px) {
      .donate-container {
        margin: 20px;
        padding: 30px 20px;
      }
      
      .hero h1 {
        font-size: 2.2rem;
      }
      
      .hero p {
        font-size: 1.2rem;
      }
      
      .donate-container h2 {
        font-size: 1.8rem;
      }
      
      .donate-container p {
        font-size: 1rem;
        margin-bottom: 30px;
      }
      
      .donation-options {
        grid-template-columns: 1fr;
        gap: 20px;
        margin: 30px 0;
      }
      
      .divider {
        order: 0;
        padding: 10px 0;
        font-size: 0.8rem;
      }
      
      .amount-btn {
        padding: 16px 24px;
        font-size: 1rem;
        max-width: 250px;
      }
      
      .custom-amount-section {
        max-width: 250px;
      }
      
      .custom-amount-input {
        gap: 10px;
      }
      
      .custom-amount-input input {
        padding: 14px 16px;
        font-size: 0.9rem;
      }
      
      .custom-donate-btn {
        padding: 14px 20px;
        font-size: 0.9rem;
      }
    }
  </style>
</head>

<body>
  <div id="header-placeholder"></div>

  <div class="hero">
    <h1>Support Rejewvenate</h1>
    <p>Your donation helps us create meaningful Jewish experiences for college students</p>
  </div>

        <div class="donate-container">
        <h2>Rosh Hashana Registration</h2>
        <p>Please proceed with no cost or consider an optional donation of $54 or an amount of your choosing.</p>
        
        <form id="registrationForm">
          <div class="form-section">
            <h3>Your Information</h3>
            <div class="form-row">
              <div class="form-group">
                <label for="firstName">First Name *</label>
                <input 
                  type="text" 
                  id="firstName" 
                  name="firstName" 
                  required
                  placeholder="Enter your first name"
                >
              </div>
              <div class="form-group">
                <label for="lastName">Last Name *</label>
                <input 
                  type="text" 
                  id="lastName" 
                  name="lastName" 
                  required
                  placeholder="Enter your last name"
                >
              </div>
            </div>
            <div class="form-group">
              <label for="email">Email Address *</label>
              <input 
                type="email" 
                id="email" 
                name="email" 
                required
                placeholder="Enter your email address"
              >
            </div>
          </div>
          
          <div class="form-section">
            <h3>Donation (Optional)</h3>
            <div class="donation-options">
              <button type="button" class="amount-btn" id="zeroBtn" onclick="donateAmount(0)">
                Proceed Free
              </button>
              
              <div class="divider">
                OR
              </div>
              
              <div class="custom-amount-section">
                <h4>Enter Custom Amount</h4>
                <div class="custom-amount-input">
                  <input 
                    type="number" 
                    id="customAmount" 
                    placeholder="Enter amount"
                    min="0"
                    step="0.01"
                    oninput="handleCustomAmountInput()"
                  >
                  <button 
                    type="button"
                    class="custom-donate-btn" 
                    id="customDonateBtn" 
                    onclick="donateCustomAmount()"
                    disabled
                  >
                    Donate
                  </button>
                </div>
              </div>
            </div>
            
            <div class="suggested-amount">
              <button type="button" class="amount-btn suggested-btn" id="fiftyFourBtn" onclick="donateAmount(54)">
                Suggested: Donate $54
              </button>
            </div>
          </div>
        </form>
      </div>

  <footer>
    <div class="socials">
      <a href="https://www.instagram.com/rejewvenate_bychb/" target="_blank">
        <img
          src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/95/Instagram_logo_2022.svg/2048px-Instagram_logo_2022.svg.png"
          alt="Instagram Logo">
        Instagram
      </a>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; margin-top: 20px; position: relative;">
      <p style="margin: 0; flex-grow: 1; text-align: center;">&copy; 2025 by Rejewvenate.</p>
      <a href="/admin/dashboard" style="color: rgba(255, 255, 255, 0.7); text-decoration: none; font-size: 0.8rem; position: absolute; right: 0; cursor: pointer; z-index: 10; padding: 5px;" 
         onmouseover="this.style.color='rgba(255, 255, 255, 1)'" 
         onmouseout="this.style.color='rgba(255, 255, 255, 0.7)'">Admin Login</a>
    </div>
  </footer>

  <script>
    // Initialize Stripe
    const stripe = Stripe('pk_live_51PT3twJb8qwjsbroMOD3Gwg9dLFKTt1C7kBaJdQH8V542RSMcYy3RJYzieEx6qNYqG4xodI4f1a35YjG1j9z8zgG00778gmwjL');
    
    // Handle custom amount input
    function handleCustomAmountInput() {
      const customAmount = document.getElementById('customAmount');
      const customDonateBtn = document.getElementById('customDonateBtn');
      const fiftyFourBtn = document.getElementById('fiftyFourBtn');
      
      if (customAmount.value && customAmount.value.trim() !== '') {
        // If custom amount is entered, unselect the $54 button
        fiftyFourBtn.style.background = 'linear-gradient(135deg, #e9e9e9 0%, #ddd 100%)';
        fiftyFourBtn.style.color = '#666';
        fiftyFourBtn.style.cursor = 'default';
        
        // Enable custom donate button if amount is valid
        const amount = parseFloat(customAmount.value);
        if (amount > 0) {
          customDonateBtn.disabled = false;
        } else {
          customDonateBtn.disabled = true;
        }
      } else {
        // If custom amount is empty, reset $54 button
        resetFiftyFourButton();
        customDonateBtn.disabled = true;
      }
    }
    
    // Reset $54 button to original state
    function resetFiftyFourButton() {
      const fiftyFourBtn = document.getElementById('fiftyFourBtn');
      fiftyFourBtn.style.background = 'linear-gradient(135deg, #004080 0%, #002244 100%)';
      fiftyFourBtn.style.color = 'white';
      fiftyFourBtn.style.cursor = 'pointer';
    }
    
    // Donate $54
    function donateAmount(amount) {
      // Clear custom amount input
      document.getElementById('customAmount').value = '';
      
      // Reset custom donate button
      document.getElementById('customDonateBtn').disabled = true;
      
      // Reset $54 button
      resetFiftyFourButton();
      
      // Process donation
      processDonation(amount);
    }
    
    // Donate custom amount
    function donateCustomAmount() {
      const customAmount = document.getElementById('customAmount');
      const amount = parseFloat(customAmount.value);
      
      if (amount >= 0) {
        processDonation(amount);
      } else {
        alert('Please enter a valid amount (0 or greater).');
      }
    }
    
    // Validate form data
    function validateForm() {
      const firstName = document.getElementById('firstName').value.trim();
      const lastName = document.getElementById('lastName').value.trim();
      const email = document.getElementById('email').value.trim();
      
      if (!firstName || !lastName || !email) {
        alert('Please fill in all required fields (First Name, Last Name, Email).');
        return false;
      }
      
      // Basic email validation
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        alert('Please enter a valid email address.');
        return false;
      }
      
      return true;
    }
    
    // Process donation through Stripe
    async function processDonation(amount) {
      try {
        // Validate form first
        if (!validateForm()) {
          return;
        }
        
        // Get form data
        const firstName = document.getElementById('firstName').value.trim();
        const lastName = document.getElementById('lastName').value.trim();
        const email = document.getElementById('email').value.trim();
        
        // If amount is 0, save to database and redirect to success page
        if (amount === 0) {
          console.log('Proceeding with free registration');
          
          // Save registration to database
          const registrationData = {
            firstName,
            lastName,
            email,
            donationAmount: 0
          };
          
          const response = await fetch('/create-rosh-hashana-registration', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(registrationData)
          });
          
          if (response.ok) {
            window.location.href = '/donation-success.html?free=true';
          } else {
            throw new Error('Failed to save registration');
          }
          return;
        }
        
        // Create form data object for paid donations
        const formData = {
          donationAmount: amount,
          donationType: 'one-time',
          firstName,
          lastName,
          email
        };
        
        console.log('Processing donation:', formData);
        
        // Determine the correct URL based on the current environment
        const baseUrl = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
          ? '' // Empty for local development
          : ''; // Empty for production as the path will be relative to the current domain
        
        // Send to server to create checkout session
        const response = await fetch(`${baseUrl}/create-checkout-session`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        });
        
        console.log('Response status:', response.status);
        
        if (!response.ok) {
          const errorText = await response.text();
          console.error('Response error:', errorText);
          throw new Error(`Server responded with ${response.status}: ${errorText}`);
        }
        
        const data = await response.json();
        console.log('Response data:', data);
        
        if (data.success) {
          // Redirect to Stripe checkout using the URL from the response
          window.location.href = data.url;
        } else {
          alert('Error: ' + (data.message || 'Unable to process donation'));
        }
      } catch (error) {
        console.error('Error:', error);
        alert('An error occurred while processing your registration. Please try again.');
      }
    }
    
    // Add event listener for Enter key on custom amount input
    document.getElementById('customAmount').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        donateCustomAmount();
      }
    });
  </script>
  <div id="footer-placeholder"></div>
  <script src="/js/components.js"></script>
</body>

</html>
